"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.placeholderUrl = exports.SIZES = exports.ALLOWED_EXT = void 0;
exports.resolveImageUrl = resolveImageUrl;
const axios_1 = __importDefault(require("axios"));
const config_1 = require("./config");
const logger_1 = require("./logger");
const normalize = (value) => {
    if (!value) {
        return undefined;
    }
    const trimmed = value.trim();
    return trimmed ? trimmed : undefined;
};
const baseFromEnv = normalize(process.env.OC_BASE_URL) ??
    normalize(process.env.OC_IMAGE_BASE_URL) ??
    normalize(config_1.config.mysql.imageBaseUrl);
const BASE_ROOT = baseFromEnv ? baseFromEnv.replace(/\/+$/, "") : undefined;
const PLACEHOLDER_URL = normalize(process.env.PLACEHOLDER_URL) ??
    "https://via.placeholder.com/800x800.png?text=Image+missing";
const HTTP_REFERER = normalize(process.env.HTTP_REFERER) ?? BASE_ROOT;
const http = axios_1.default.create({
    timeout: 20000,
    headers: {
        "User-Agent": "Mozilla/5.0 (compatible; ow-eg-etl/1.0)",
        Referer: HTTP_REFERER,
        Accept: "image/*",
    },
    maxRedirects: 5,
    validateStatus: (status) => status >= 200 && status < 400,
});
exports.ALLOWED_EXT = new Set(["jpg", "jpeg", "png", "webp", "gif", "bmp"]);
exports.SIZES = ["1000x1000", "800x800", "600x600", "500x500", "300x300"];
const ensureAbsolute = (raw) => {
    const trimmed = raw.trim();
    if (!trimmed) {
        return "";
    }
    if (/^https?:\/\//i.test(trimmed)) {
        return trimmed;
    }
    if (trimmed.startsWith("//")) {
        return `https:${trimmed}`;
    }
    if (!BASE_ROOT) {
        return "";
    }
    if (trimmed.startsWith("/")) {
        return `${BASE_ROOT}${trimmed}`;
    }
    if (trimmed.startsWith("image/")) {
        return `${BASE_ROOT}/${trimmed}`;
    }
    return `${BASE_ROOT}/image/${trimmed.replace(/^\/+/, "")}`;
};
const safeDecode = (segment) => {
    try {
        return decodeURIComponent(segment);
    }
    catch {
        return segment;
    }
};
const encodePathPreservingSlashes = (raw) => {
    try {
        const absolute = ensureAbsolute(raw.replace(/#/g, "%23"));
        if (!absolute) {
            return absolute;
        }
        const url = new URL(absolute);
        url.pathname = url.pathname
            .split("/")
            .map((segment) => encodeURIComponent(safeDecode(segment)))
            .join("/");
        return url.toString();
    }
    catch (error) {
        void logger_1.logger.debug({
            step: "image",
            message: "Failed to encode URL",
            raw,
            error: error instanceof Error ? error.message : String(error),
        });
        return "";
    }
};
const getExt = (url) => {
    const match = url.toLowerCase().match(/\.([a-z0-9]+)(?:\?|$)/);
    return match ? match[1] : "";
};
const headOk = async (url) => {
    try {
        const response = await http.head(url);
        if (!/^image\//i.test(response.headers["content-type"] ?? "")) {
            return false;
        }
        return true;
    }
    catch (error) {
        try {
            const response = await http.get(url, { headers: { Range: "bytes=0-0" } });
            return /^image\//i.test(response.headers["content-type"] ?? "");
        }
        catch (innerError) {
            void logger_1.logger.debug({
                step: "image",
                message: "Image request failed",
                url,
                error: innerError instanceof Error ? innerError.message : String(innerError),
            });
            return false;
        }
    }
};
const cacheCandidates = (original) => {
    try {
        const absolute = new URL(original);
        const marker = "/image/catalog/";
        const idx = absolute.pathname.toLowerCase().indexOf(marker);
        if (idx === -1) {
            return [];
        }
        const relative = absolute.pathname.slice(idx + marker.length);
        const lastSlash = relative.lastIndexOf("/");
        const dir = lastSlash === -1 ? "" : relative.slice(0, lastSlash + 1);
        const file = lastSlash === -1 ? relative : relative.slice(lastSlash + 1);
        const name = file.replace(/\.[^.]+$/, "");
        const ext0 = getExt(file);
        const exts = Array.from(new Set([ext0, ...exports.ALLOWED_EXT])).filter(Boolean);
        const root = BASE_ROOT ?? `${absolute.protocol}//${absolute.host}`;
        const candidates = [];
        for (const size of exports.SIZES) {
            for (const ext of exts) {
                const candidate = `${root}/image/cache/catalog/${dir}${name}-${size}.${ext}`;
                candidates.push(candidate);
            }
        }
        return candidates.map((candidate) => encodePathPreservingSlashes(candidate));
    }
    catch (error) {
        void logger_1.logger.debug({
            step: "image",
            message: "Failed to build cache fallback",
            original,
            error: error instanceof Error ? error.message : String(error),
        });
        return [];
    }
};
const placeholderResult = (attempts, raw) => {
    void logger_1.logger.warn({
        step: "image",
        message: "Using placeholder image",
        raw,
        attempts,
    });
    return {
        url: PLACEHOLDER_URL,
        reason: "placeholder",
        attempts,
    };
};
async function resolveImageUrl(raw) {
    if (!raw) {
        return placeholderResult([], raw);
    }
    const attempts = [];
    const encoded = encodePathPreservingSlashes(raw);
    if (encoded) {
        attempts.push(encoded);
        const ext = getExt(encoded);
        if (!ext || exports.ALLOWED_EXT.has(ext)) {
            if (await headOk(encoded)) {
                return { url: encoded, reason: "original", attempts };
            }
        }
    }
    const fallbacks = cacheCandidates(encoded || ensureAbsolute(raw));
    for (const candidate of fallbacks) {
        attempts.push(candidate);
        if (await headOk(candidate)) {
            void logger_1.logger.info({
                step: "image",
                message: "Using cached OpenCart thumbnail fallback",
                raw,
                candidate,
            });
            return { url: candidate, reason: "cache", attempts };
        }
    }
    return placeholderResult(attempts, raw);
}
const placeholderUrl = () => PLACEHOLDER_URL;
exports.placeholderUrl = placeholderUrl;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtcmVzb2x2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZXRsL2ltYWdlLXJlc29sdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQWtMQSwwQ0FnQ0M7QUFsTkQsa0RBQTBCO0FBRTFCLHFDQUFrQztBQUNsQyxxQ0FBa0M7QUFFbEMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxLQUFnQyxFQUFzQixFQUFFO0lBQ3pFLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNYLE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFDRCxNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDN0IsT0FBTyxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQ3ZDLENBQUMsQ0FBQztBQUVGLE1BQU0sV0FBVyxHQUNmLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQztJQUNsQyxTQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQztJQUN4QyxTQUFTLENBQUMsZUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUV2QyxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7QUFFNUUsTUFBTSxlQUFlLEdBQ25CLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQztJQUN0Qyw0REFBNEQsQ0FBQztBQUUvRCxNQUFNLFlBQVksR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsSUFBSSxTQUFTLENBQUM7QUFFdEUsTUFBTSxJQUFJLEdBQUcsZUFBSyxDQUFDLE1BQU0sQ0FBQztJQUN4QixPQUFPLEVBQUUsS0FBSztJ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