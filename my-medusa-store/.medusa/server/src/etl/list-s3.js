"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = main;
const client_s3_1 = require("@aws-sdk/client-s3");
async function main() {
    const region = process.env.AWS_REGION || "ap-south-1";
    const bucket = process.env.OBJECT_STORAGE_BUCKET || "oweg-media-mumbai-krj-2025";
    // If LIST_PREFIX is set, use it. Else use OBJECT_STORAGE_PREFIX + "/products/"
    const base = process.env.OBJECT_STORAGE_PREFIX || "opencart";
    const fallback = (base.replace(/\/+$/, '') + "/products/").replace(/\/+/g, "/");
    const prefix = (process.env.LIST_PREFIX || fallback).replace(/\/+/g, "/");
    const client = new client_s3_1.S3Client({
        region,
        credentials: {
            accessKeyId: process.env.AWS_ACCESS_KEY_ID || "",
            secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || "",
        },
    });
    let token = undefined;
    let total = 0;
    console.log("Listing with prefix:", prefix);
    do {
        const res = await client.send(new client_s3_1.ListObjectsV2Command({
            Bucket: bucket,
            Prefix: prefix,
            ContinuationToken: token,
        }));
        for (const o of res.Contents || []) {
            const when = o.LastModified ? new Date(o.LastModified).toISOString() : "";
            console.log(`${when}\t${o.Key}`);
        }
        total += res.KeyCount || 0;
        token = res.IsTruncated ? res.NextContinuationToken : undefined;
    } while (token);
    console.log(`---\nTOTAL: ${total}`);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1zMy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9ldGwvbGlzdC1zMy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLHVCQXNDQztBQXhDRCxrREFBb0U7QUFFckQsS0FBSyxVQUFVLElBQUk7SUFDaEMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksWUFBWSxDQUFDO0lBQ3RELE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLElBQUksNEJBQTRCLENBQUM7SUFFakYsK0VBQStFO0lBQy9FLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLElBQUksVUFBVSxDQUFDO0lBQzdELE1BQU0sUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUMsRUFBRSxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUMvRSxNQUFNLE1BQU0sR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFMUUsTUFBTSxNQUFNLEdBQUcsSUFBSSxvQkFBUSxDQUFDO1FBQzFCLE1BQU07UUFDTixXQUFXLEVBQUU7WUFDWCxXQUFXLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsSUFBSSxFQUFFO1lBQ2hELGVBQWUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixJQUFJLEVBQUU7U0FDekQ7S0FDRixDQUFDLENBQUM7SUFFSCxJQUFJLEtBQUssR0FBdUIsU0FBUyxDQUFDO0lBQzFDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztJQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFNUMsR0FBRyxDQUFDO1FBQ0YsTUFBTSxHQUFHLEdBQUcsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksZ0NBQW9CLENBQUM7WUFDckQsTUFBTSxFQUFFLE1BQU07WUFDZCxNQUFNLEVBQUUsTUFBTTtZQUNkLGlCQUFpQixFQUFFLEtBQUs7U0FDekIsQ0FBQyxDQUFDLENBQUM7UUFFSixLQUFLLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxRQUFRLElBQUksRUFBRSxFQUFFLENBQUM7WUFDbkMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDMUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNuQyxDQUFDO1FBRUQsS0FBSyxJQUFJLEdBQUcsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDO1FBQzNCLEtBQUssR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUNsRSxDQUFDLFFBQVEsS0FBSyxFQUFFO0lBRWhCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0FBQ3RDLENBQUMifQ==